# GeneAgent Workflow Tutorial

## Project Overview

GeneAgent is a language agent built upon GPT-4 that automatically interacts with domain-specific databases to provide functional annotations for gene set analysis. The project includes three distinct workflows, each with unique approaches and application scenarios.

## Three Main Workflows

### 1. Cascade Workflow (`main_cascade.py`)

**Core Feature: Self-verification Cascade System**

This is the core workflow of GeneAgent, employing a multi-step self-verification mechanism to ensure accuracy and reliability of results.

#### Workflow Steps:

1. **Initial Analysis Generation**
   - Uses GPT-4 to perform initial analysis on input gene sets
   - Generates biological process names and detailed analysis
   - Output format: `Process: <process_name>`

2. **Process Name Verification**
   - Extracts the generated process name
   - Generates claims that need verification
   - Uses AgentPhD to interact with multiple biological database APIs for fact verification
   - Supported databases include:
     - Protein complex databases
     - Disease association databases
     - Protein domain databases
     - Enrichment analysis databases
     - Pathway databases
     - Interaction databases
     - Gene summary databases
     - PubMed literature databases

3. **Process Name Modification**
   - Modifies original process name based on verification results
   - If claims are supported, retains original name with minor grammar revisions
   - If partially supported, discards unsupported parts
   - If refuted, replaces with the most significant biological function term

4. **Analysis Content Verification**
   - Generates new verification claims for the modified analysis content
   - Uses AgentPhD again for fact verification
   - Focuses on verifying associations between gene functions and biological processes

5. **Final Summarization**
   - Generates final gene set analysis report based on all verification results
   - Ensures all claims have reliable scientific evidence support

#### Output Files:
- `Outputs/GPT-4/MsigDB_Response_GPT4.txt` - Original GPT-4 responses
- `Outputs/GeneAgent/Cascade/MsigDB_Final_Response_GeneAgent.txt` - Final verified results
- `Verification Reports/Cascade/Claims_and_Verification_for_MsigDB.txt` - Verification reports

### 2. Chain-of-Thought Workflow (`main_CoT.py`)

**Core Feature: Step-by-step Reasoning Chain**

This is a simplified workflow that uses Chain-of-Thought prompting techniques to guide the model through structured reasoning.

#### Workflow Steps:

1. **Step 1: Critical Analysis of Gene Functions**
   - Describes reasoning process and supporting information for each important point
   - Conducts in-depth functional analysis

2. **Step 2: Functional Association Analysis Between Genes**
   - Analyzes functional associations between different genes from critical analysis
   - Identifies common biological themes

3. **Step 3: Biological Process Name Summarization**
   - Summarizes the most important biological process name from functional associations
   - Provides concise process naming

#### Features:
- No verification steps, relies on model's internal knowledge
- Fast processing, suitable for quick analysis
- Structured reasoning process improves result logic

#### Output Files:
- `Outputs/Chain-of-Thought/MsigDB_Response_CoT.txt`

### 3. Summary Workflow (`main_summary.py`)

**Core Feature: Enrichment Analysis Based on Verified Information**

This workflow utilizes verification information generated by the Cascade workflow to perform deeper term enrichment analysis.

#### Workflow Steps:

1. **Verification Information Extraction**
   - Extracts functional descriptions from Cascade workflow verification reports
   - Parses verified gene function information

2. **Term Enrichment Testing**
   - Performs term enrichment testing on genes
   - Executes Gene Ontology (GO) term testing
   - Identifies functional commonalities and classification hierarchies

3. **Statistical Significance Analysis**
   - Reports only statistically over-represented terms
   - Provides hypotheses for biological mechanisms or pathways

4. **Structured Output**
   - High-level summary
   - List of enriched terms
   - List of GO terms
   - Corresponding gene names

#### Output Format:
```
Summary: <high_level_summary>
Enriched Terms: <term1>; <term2>; <term3>
GO Terms: <term1>; <term2>; <term3>
```

#### Output Files:
- `Outputs/EnrichedTermTest/gpt.geneagent.msigdb.summary.result.verification.txt`

## Workflow Comparison

| Feature | Cascade | Chain-of-Thought | Summary |
|---------|---------|------------------|---------|
| **Verification Mechanism** | Multi-step self-verification | No verification | Based on verified information |
| **Accuracy** | Highest | Medium | High |
| **Processing Time** | Longest | Shortest | Medium |
| **Use Cases** | High-precision research | Quick preliminary analysis | In-depth enrichment analysis |
| **Output Detail Level** | Detailed analysis report | Structured reasoning | Enriched term lists |

## Usage Recommendations

### Choose Cascade Workflow When:
- High accuracy and reliability are required
- Conducting formal scientific research
- Need verifiable scientific evidence support
- Time allows for in-depth analysis

### Choose Chain-of-Thought Workflow When:
- Need quick preliminary analysis
- In exploratory research phase
- Limited resources available
- Need to understand reasoning process

### Choose Summary Workflow When:
- Already have Cascade verification results
- Need term enrichment analysis
- Focus on GO term annotations
- Need statistical significance analysis

## Configuration and Execution

### Environment Setup
1. Ensure all required dependencies are installed (see `requirements.txt`)
2. Configure OpenAI API key in `.env` file
3. Prepare gene set data files

### Execution Commands
```bash
# Cascade workflow
python main_cascade.py

# Chain-of-Thought workflow
python main_CoT.py

# Summary workflow (requires Cascade to be run first)
python main_summary.py
```

### Datasets
The project supports three datasets:
- **Gene Ontology**: 1000 gene sets from GO:BP branch
- **MsigDB**: 56 gene sets including hallmark gene sets
- **NeST**: 50 gene sets sampled from human cancer proteomic data

## Output Interpretation

### Cascade Workflow Output Example
```
Process: MAPK Signaling Pathway
The proteins encoded by the genes ERBB2, ERBB4, FGFR2, FGFR4, HRAS, and KRAS are all integral components of the MAPK signaling pathway, which is crucial for cell growth, differentiation, and survival...
```

### Verification Report Format
Verification reports contain:
- Original claims
- Verification results
- Supporting evidence
- Database sources

## Best Practices

1. **Data Preparation**: Ensure gene names are correctly formatted using standard gene symbols
2. **Result Verification**: Always check verification reports to understand evidence quality
3. **Workflow Selection**: Choose appropriate workflow based on research needs and time constraints
4. **Result Interpretation**: Combine domain knowledge when interpreting analysis results
5. **Quality Control**: For important research, recommend using Cascade workflow

## Troubleshooting

### Common Issues:
1. **API Limitations**: If encountering API call limits, adjust request frequency
2. **Gene Name Errors**: Ensure use of standard HGNC gene symbols
3. **Network Connectivity**: Ensure access to external biological database APIs
4. **Memory Issues**: For large gene sets, may need to increase system memory

### Debugging Suggestions:
- Check `.env` file configuration
- Verify data file format
- Review error log files
- Test network connectivity

## Summary

GeneAgent provides three complementary workflows, from quick exploratory analysis to in-depth verified research. The Cascade workflow is the core innovation, significantly improving the reliability of gene set analysis through self-verification mechanisms. Choosing the appropriate workflow can maximize research efficiency and result quality.
